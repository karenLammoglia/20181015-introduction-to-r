---
title: "Import"
author: "Luis de Sousa"
date: "2018/10/01 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    css: ["assets/kunoichi.css", "assets/ninpo.css", "assets/ninjutsu.css"]
    self_contained: false
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r import-setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "png",
  cache = TRUE,
  cache.path = ".cache/",
  fig.path = "imgs/",
  fig.width = 11,
  fig.height = 5
)
options(htmltools.dir.version = FALSE)
```

layout: false

class: split-70 hide-slide-number
background-image: url("imgs/HEAD-Top-data-visualization-tools-for-small-business.png")
background-size: cover

.column.slide-in-left[
.sliderbox.vmiddle.shade_main.center[
.font5[Import]]]
.column[
]

---

# Importing Data

R can import data from a diverse set of data sources:

--

- Flat files like plain text and delimited data - .txt, .csv, .tsv

--

- Data files from proprietary software like - Microsoft Excel, SPSS, SAS

--

- Directly from Databases - MySQL, MS SQL Server, PostgreSQL

--

- Directly from the Web - APIs, JSON, HTML

---

# Importing Data - CSV

```{r import-csv-1}
library(tidyverse) #packages for data manipulation, exploration and visualization that share a common design philosophy
exchange_rates <- read.csv("data/ZAR_per_USD__Exchange_Rate_Detail_2000_to_2018-10.csv") # import all ZAR USD exchange rates from 2000 to 2018-10-08

head(exchange_rates,4) # show top 4 rows of data frame
tail(exchange_rates,4) # show bottom 4 rows of data frame
```

---

# Importing Data - CSV

```{r import-csv-2}
exchange_rates <- exchange_rates %>%
  filter(as.Date(exchange_rates$Date) >= as.Date('2018-01-01')) # filter for 2018 exchange rates

head(exchange_rates,4)
tail(exchange_rates,4)
```

---

# Importing Data - Multiple Excel Sheets

```{r import-excel-1}
library(readxl) # for reading excel files
path <- "data/gapminder_messy.xlsx"
combined_data <- excel_sheets(path) %>% 
  map_df(~ {
    read_excel(path, sheet = .x, 
               skip = 4, trim_ws = TRUE) %>% 
      mutate(year = as.numeric(.x))
  }) %>% 
  select(country, year, everything())
```

---

# Importing Data - Multiple Excel Sheets to 1 Data Frame

```{r import-excel-2}
head(combined_data,4)
tail(combined_data,4)
```

---

# Importing Data - SPSS

```{r import-spss-1}
library(haven) # for reading SPSS, SAS, STATA files
survey_data <- read_sav("data/sample_spss_data.sav")
head(survey_data)
```

---

# Importing Data - SPSS

```{r import-spss-2}
# convert spss label codes into labels
labelled_survey_data <- as_factor(survey_data)
head(labelled_survey_data)
```

---

# Importing Data - SPSS

```{r import-spss-3}
labelled_survey_data %>% 
count(fQ1bGender, dAge) %>% 
spread(fQ1bGender, n)
```

---

# Importing Data - Databases

```{r import-databases-1}
library(DBI) # for connecting to databases

con <- dbConnect(
drv = RMySQL::MySQL(),
dbname = "shinydemo",
host = "shiny-demo.csa7qlmguqrf.us-east-1.rds.amazonaws.com",
username = "guest",
password = "guest"
)

dbListTables(con)
```

---

# Importing Data - Databases

```{r import-databases-2}

cities <- tbl(con, "City")
cities
```

---

# Importing Data - Web APIs

```{r web-apis}
library(jsonlite) #JSON parser and generator

github_issues <- function(user, repo){
  url <- paste0("https://api.github.com/repos/", user, "/", repo, "/issues")
  return(fromJSON(url))
}
dplyr_github_issues <- github_issues("hadley","dplyr")

head(dplyr_github_issues$title)
```