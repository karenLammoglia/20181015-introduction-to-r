---
title: "Import"
author: "Luis de Sousa"
date: "2018/10/01 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    css: ["assets/kunoichi.css", "assets/ninpo.css", "assets/ninjutsu.css"]
    self_contained: false
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r import-setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  dev = "svg",
  cache = TRUE,
  cache.path = ".cache/",
  fig.path = "imgs/",
  fig.width = 11,
  fig.height = 5
)
options(htmltools.dir.version = FALSE)
```

class: split-70 hide-slide-number
background-image: url("imgs/HEAD-Top-data-visualization-tools-for-small-business.png")
background-size: cover

.column.slide-in-left[
.sliderbox.vmiddle.shade_main.center[
.font5[Import]]]
.column[
]

---

# Importing Data

R can import data from a diverse set of data sources:
* Flat files like plain text and delimited data: .txt, .csv, .tsv
* Data files from proprietary software: MS Excel, SPSS, SAS
* Directly from Databases: MySQL, MS SQL Server, PostgreSQL
* Directly from the Web: APIs, JSON, Webscrape HTML

---

# Importing Data - CSV

```{r Import CSV}
library(tidyverse)
exchange_rates <- read.csv("data/ZAR_per_USD__Exchange_Rate_Detail_2000_to_2018-10.csv") # import all ZAR USD exchange rates from 2000 to 2018-10-08
exchange_rates <- exchange_rates %>%
  filter(as.Date(exchange_rates$Date) >= as.Date('2018-01-01')) # filter for 2018 exchange rates
# show top and bottom 6 rows of data frame
head(exchange_rates)
tail(exchange_rates)
```

---

# Importing Data - Multiple Excel Sheets to 1 Data Frame

```{r Import Excel}
library(readxl) # for reading excel files
path <- "data/gapminder_messy.xlsx"
combined_data <- excel_sheets(path) %>% 
  map_df(~ {
    read_excel(path, sheet = .x, 
               skip = 4, trim_ws = TRUE) %>% 
      mutate(year = as.numeric(.x))
  }) %>% 
  select(country, year, everything())
# show top and bottom 6 rows of data frame
head(combined_data)
tail(combined_data)
```

---

# Importing Data - SPSS

```{r, Import SPSS}
library(haven) # for reading SPSS, SAS, STATA files
survey_data <- read_sav("data/sample_spss_data.sav")
head(survey_data)
# convert spss label codes into labels
labelled_survey_data <- as_factor(survey_data)
head(labelled_survey_data)
labelled_survey_data %>% 
count(fQ1bGender, dAge) %>% 
spread(fQ1bGender, n) %>% 
knitr::kable(format = "html")
```

---

# Importing Data - Databases

```{r, Import Databases}
library(DBI) # for connecting to databases
con <- dbConnect(
drv = RMySQL::MySQL(),
dbname = "shinydemo",
host = "shiny-demo.csa7qlmguqrf.us-east-1.rds.amazonaws.com",
username = "guest",
password = "guest"
)
dbListTables(con)
cities <- tbl(con, "City")
cities
```

---

# Importing Data - Web APIs

```{r, Web APIs}
library(httr)
library(jsonlite)

github <- fromJSON("https://api.github.com/users/hadley/orgs")
names(github)
github$login
```

